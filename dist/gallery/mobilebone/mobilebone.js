!function(a,b){"function"==typeof define&&(define.amd||define.cmd)?define("mobilebone",function(c){return b(a,c)}):a.Mobilebone=b(a,{})}(this,function(a,b){var c={},d=[],e=d.slice,f=/^.[^:#\[\.,]*$/,g="pushState"in history&&"replaceState"in history&&!(window.navigator.userAgent.indexOf("Firefox")>=0&&window.top!==window)&&-1===window.navigator.userAgent.search(/CriOS/);if(b.support=g,0==g)return b;var h=!1;b.VERSION="1.1.6",b.captureLink=!0,b.rootTransition=a,b.mergeCallback=!0,b.classPage="page",b.classMask="mask",b.pushStateEnabled=!0,b.transition=function(a,d,e,f){if(0!=arguments.length&&a!=d){3==arguments.length&&1==isNaN(1*e)&&(f=e,e=!1),d=d||null,e=e||!1,f=f||{};var h={root:this.rootTransition,form:this.form||"slide",onpagefirstinto:this.onpagefirstinto,animationstart:this.animationstart,animationend:this.animationend,fallback:this.fallback,callback:this.callback},j=function(a){if(!a||!a.getAttribute)return{};var c={},d=i(a.getAttribute("data-params")||"");return["title","root","form"].forEach(function(b){c[b]=a.getAttribute("data-"+b)||d[b]||f[b]||h[b]}),"string"==typeof c.root&&(c.root=b.getFunction(c.root)),["onpagefirstinto","callback","fallback","animationstart","animationend"].forEach(function(e){if(1==b.mergeCallback&&"function"==typeof h[e]){var g=a.getAttribute("data-"+e)||d[e];c[e]="function"==typeof c.root[g]?function(){h[e].apply(null,arguments),c.root[g].apply(null,arguments)}:"function"==typeof f[e]?function(){h[e].apply(null,arguments),f[e].apply(null,arguments)}:h[e]}else c[e]=a.getAttribute("data-"+e)||d[e]||f[e]||h[e]}),c},k=j(d),l=j(a);if(null!=d&&d.classList){d.classList.add("out"),d.classList.add(k.form),d.classList.remove("in"),d.classList[e?"add":"remove"]("reverse");var m=k.fallback;"string"==typeof m&&(m=k.root[m]),"function"==typeof m&&m(a,d,f.response)}if(null!=a&&a.classList){var n=l.title,o=document.querySelector("h1"),p=document.querySelector("."+this.classPage);n?(document.title=n,o&&(o.innerHTML=n,o.title=n)):p==a&&!d&&document.title&&a.setAttribute("data-title",document.title);var q=f.id||a.id;c[q]&&c[q]!=a&&(c[q].parentElement.removeChild(c[q]),delete c[q]),a.style.display="block",a.clientWidth,a.classList.remove("out"),a.classList.add("in"),d&&a.classList.add(l.form),a.classList[e?"add":"remove"]("reverse");var r=l.onpagefirstinto;c[q]||("string"==typeof r&&l.root[r]?l.root[r](a,d,f.response):"function"==typeof r&&r(a,d,f.response));var s="WebkitAppearance"in document.documentElement.style||"undefined"!=typeof document.webkitHidden;["animationstart","animationend"].forEach(function(b,d){var e=l[b],f="webkit"+b.replace(/^a|s|e/g,function(a){return a.toUpperCase()});if(!c[q]){var g=s?f:b;d&&a.addEventListener(g,function(){0==this.classList.contains("in")&&(this.style.display="none")}),"string"==typeof e&&l.root[e]?a.addEventListener(g,function(){l.root[e](this,this.classList.contains("in")?"into":"out")}):"function"==typeof e&&a.addEventListener(g,function(){e(this,this.classList.contains("in")?"into":"out")})}});var t=q;t&&0==/^#/.test(t)&&(t="#"+t),g&&this.pushStateEnabled&&f.history!==!1&&t&&history[d?"pushState":"replaceState"](null,document.title,t.replace(/^#/,"#&")),c[q]||(c[q]=a);var u=l.callback;"string"==typeof u&&(u=l.root[u]),"function"==typeof u&&u(a,d,f.response)}}},b.getCleanUrl=function(a,b,c){var d="",e="",f="";if(a&&(1==a.nodeType?(d=a.getAttribute("href"),e=a.getAttribute("data-formdata")||a.getAttribute("data-data")):a.url&&(d=a.url,e=a.data)),!(d=d||b))return"";if(e=e||c||"","object"==typeof e){var g=[];for(key in c)g.push(key+"="+encodeURIComponent(c[key]));e=g.length>0?g.join("&"):""}return f=d.split("#")[0].replace(/&+$/,""),"?"==f.slice(-1)&&(f=f.split("?")[0]),""!=e&&(/\?/.test(f)?(e=e.replace(/^&|\?/,""),f=f+"&"+e):""!=e&&(e=e.replace("?",""),f=f+"?"+e)),f},b.createPage=function(a,b,c){var d=null;if(a){c=c||{};var e,f=document.querySelector(".in."+this.classPage);b&&(1==b.nodeType?(b.href&&(e=b.getAttribute("data-title")||c.title),d=c.response):(d=b.response||c.response,e=b.title||c.title));var g=null,h=document.createElement("div");"string"==typeof a?h.innerHTML=a:h.appendChild(a);var i=h.getElementsByTagName("title")[0];(g=h.querySelector("."+this.classPage))?i?g.setAttribute("data-title",i.innerText):"string"==typeof e&&g.setAttribute("data-title",e):(h.className="page out","string"==typeof e&&h.setAttribute("data-title",e),g=h),document.body.appendChild(g),h=null,this.transition(g,f,{response:d||a,id:this.getCleanUrl(b)||g.id||"unique"+Date.now()})}},b.getFunction=function(b){if("string"==typeof b){for(var c=a,d=b.split("."),e=0;e<d.length&&(c=c[d[e]]);e+=1);return c}},b.ajax=function(a){if(a){var c,d={url:"",dataType:"",data:{},timeout:1e4,async:!0,username:"",password:"",success:function(){},error:function(){},complete:function(){}},e={},f=null,g={};if(1==a.nodeType){g=i(a.getAttribute("data-params")||"");for(key in d)e[key]=a.getAttribute("data-"+key)||g[key]||d[key],"function"==typeof d[key]&&"string"==typeof e[key]&&(e[key]=this.getFunction(e[key]),"function"!=typeof e[key]&&(e[key]=d[key]));e.url=this.getCleanUrl(a,e.url),c=a.getAttribute("data-mask"),("true"==c||""==c)&&(f=a.querySelector("."+this.classMask))}else{if(!a.url)return;for(key2 in d)e[key2]=a[key2]||d[key2];e.url=this.getCleanUrl(null,e.url,e.data),e.title=a.title}"string"!=typeof c&&(f=document.querySelector("body > ."+this.classMask)),null==f&&(f=document.createElement("div"),f.className=this.classMask,f.innerHTML='<i class="loading"></i>',"string"==typeof c?a.appendChild(f):document.body.appendChild(f)),f.style.visibility="visible";var h=new XMLHttpRequest;h.open("GET",e.url+(/\?/.test(e.url)?"&":"?")+"r="+Date.now(),e.async,e.username,e.password),h.timeout=e.timeout,h.onload=function(){var c=null;if(200==h.status){if("json"==e.dataType||"JSON"==e.dataType)try{c=JSON.parse(h.response),e.response=c,b.createPage(b.jsonHandle(c),a,e)}catch(d){e.message="JSON parse errorï¼š"+d.message,e.error.call(e,h,h.status)}else if("unknown"==e.dataType)try{c=JSON.parse(h.response),e.response=c,b.createPage(b.jsonHandle(c),a,e)}catch(d){c=h.response,b.createPage(c,a,e)}else c=h.response,b.createPage(c,a,e);e.success.call(e,c,h.status)}else e.message="The status code exception!",e.error.call(e,h,h.status);e.complete.call(e,h,h.status),f.style.visibility="hidden"},h.onerror=function(){e.message="Illegal request address or an unexpected network error!",e.error.call(e,h,h.status),f.style.visibility="hidden"},h.ontimeout=function(){e.message="The request timeout!",e.error.call(e,h,h.status),f.style.visibility="hidden"},h.send(null)}},b.isBack=function(a,c){var d=-1,f=-1;return 1==history.tempBack?f=0:e.call(document.querySelectorAll("."+b.classPage)).forEach(function(b,e){b==a?d=e:b==c&&(f=e)}),history.tempBack=null,f>d},b.jsonHandle=function(){return'<p style="text-align:center;">Dear master, if you see me, show that JSON parsing function is undefined!</p>'},b.init=function(){if(1==h)return"Don't repeat initialization!";var c=location.hash.replace("#&","#"),d=null;""==c||"#"==c?this.transition(document.querySelector("."+this.classPage)):1==f.test(c)&&(d=document.querySelector(c))&&d.classList.contains(this.classPage)?this.transition(d):this.ajax({url:c.replace("#",""),dataType:"unknown",error:function(){d=document.querySelector("."+b.classPage),b.transition(d)}});var e="click",g=a.$||a.jQuery||a.Zepto;g&&g.fn&&g.fn.tap&&(e="tap"),1==this.captureLink&&(document.addEventListener(e,this.handleTapEvent),"tap"==e&&document.addEventListener("click",function(a){var c=a.target;if(c&&("a"==c.tagName.toLowerCase()||(c=c.getParentElementByTag("a")))){var d=c.getAttribute("data-ajax"),e=c.href;"external"==c.getAttribute("data-rel")||"false"==d||e.split("/")[0]!==location.href.split("/")[0]&&"true"!=d||0==b.captureLink&&"true"!=d||a.preventDefault()}})),h=!0},b.handleTapEvent=function(a){var d=a.target||a.touches[0],e=d.href;e&&0!=/a/i.test(d.tagName)||!(d=d.getParentElementByTag("a"))||(e=d.href);var f=document.querySelector(".in."+b.classPage);if(null!=f&&d){var g=d.getElementsByClassName(b.classMask)[0];if(g&&"hidden"!=g.style.visibility)return a.preventDefault(),!1;var h=1==b.captureLink,i=d.getAttribute("data-rel"),j=!1;"back"==i&&(j=!0);var k="external"==i;if(e){if(""===d.getAttribute("href").replace(/#/g,""))return void a.preventDefault();if(/^javascript/.test(e)){if(0==j)return}else if(k=k||e.split("/")[0]!==location.href.split("/")[0],(1==k||0==h)&&"true"!=d.getAttribute("data-ajax"))return;if(1==/^#/.test(d.getAttribute("href"))){var l=e.split("#")[1],m=l&&document.getElementById(l);0==j&&"auto"==i&&(j=b.isBack(m,f)),m&&b.transition(m,f,j),a.preventDefault()}else if(/^javascript/.test(e))history.tempBack=!0,history.back();else if("false"!=d.getAttribute("data-ajax")){var n=b.getCleanUrl(d),o=d.getAttribute("data-reload"),p=d.getAttribute("href");null!=o&&"false"!=o||!c[n]?b.ajax(d):(0==j&&"auto"==i&&(j=b.isBack(c[p],f)),b.transition(c[p],f,j,{id:p})),a.preventDefault()}}}},Element.prototype.getParentElementByTag=function(a){if(!a)return null;var b=null,c=this,d=function(){c=c.parentElement;var e=c.tagName.toLowerCase();e===a?b=c:"body"==e?b=null:d()};return d(),b};var i=function(a){var b={};return"string"==typeof a&&a.split("&").forEach(function(a){var c=a.split("=");c.length>1&&(b[c[0]]=a.replace(c[0]+"=",""))}),b};return window.addEventListener("DOMContentLoaded",function(){0==h&&b.init()}),window.addEventListener("popstate",function(){var a=location.hash.replace("#&","").replace("#","");if(""!=a&&0!=f.test(a)){var d=c[a]||document.querySelector("#"+a),e=document.querySelector(".in."+b.classPage);d&&d==e||0==b.pushStateEnabled||d&&b.transition(d,e,b.isBack(d,e),{history:!1})}}),b});